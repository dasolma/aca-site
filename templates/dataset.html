<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="../../files/include.js"></script>
    <div w3-include-html="../meta.html"></div>

    <link rel="stylesheet" href="/files/bootstrap.min.css">
    <script src="/files/jquery.min.js"></script>
    <script src="/files/bootstrap.min.js"></script>
      <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body id="page-top">

<div w3-include-html="../menu.html"></div>

<div class="page">
  <div class="container">
        <div class="container">

            <div class="row">

                <div class="col-sm">

                    <!-- Page Wrapper -->
                    <div id="wrapper">

                        <!-- Content Wrapper -->
                        <div id="content-wrapper" class="d-flex flex-column">

                            <!-- Main Content -->
                            <div id="content">


                                <!-- Begin Page Content -->
                                <div class="container-fluid">

                                    <h2>{{name}}</h2>
                                    <p>{{description}}</p>

                                    <!-- Content Row -->
                                    <div class="row">

                                        <!-- System Description -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">System Description</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">

                                                    <ul class=>
                                                    {% for name, desc in system.description.items() %}
                                                        <li class="">{{name}}: {{desc}}</li>
                                                    {% endfor %}
                                                    </ul>
                                                    &nbsp;

                                                    <div id="system_images_carousel" class="carousel slide" data-ride="carousel">
                                                      <div class="carousel-inner">
                                                          {% for image in system.images %}
                                                           <img class="d-block w-100" src="../../images/{{image}}" >
                                                          {% endfor %}

                                                      </div>
                                                      <a class="carousel-control-prev" href="#system_images_carousel" role="button" data-slide="prev">
                                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                        <span class="sr-only">Previous</span>
                                                      </a>
                                                      <a class="carousel-control-next" href="#system_images_carousel" role="button" data-slide="next">
                                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                        <span class="sr-only">Next</span>
                                                      </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <!-- Resources -->
                                        {% for name, items in resources.items() %}
                                        {% set cols = [0,5,4,2] %}

                                         <div class="col-xl-{{cols[loop.index]}} col-lg-{{cols[loop.index]}}">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">{{name}}</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body text-center">

                                                    <ul class="d-flex flex-wrap resource">
                                                        {% for item_name, item in items.items() %}
                                                        <li class="h5 text-gray-800">
                                                            <div class="row no-gutters align-items-center">
                                                                <div class="col mr-2">
                                                                    <div class="text-xs font-weight-bold {% if item_name == 'zipped' %}text-success{% endif %}{% if item_name == 'unzipped' %}text-warning{% endif %}{% if item_name == 'RAM' %}text-info{% endif %} text-uppercase mb-1">
                                                                        {{item_name}}
                                                                    </div>
                                                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{item}}</div>
                                                                </div>
                                                                <div class="col-auto">
                                                                    {% if item_name == 'zipped' %}<i class="fa-solid fa-file-zipper fa-2x text-gray-300"></i>{% endif %}{% if item_name == 'unzipped' %}<i class="fa-solid fa-folder fa-2x text-gray-300"></i>{% endif %}{% if item_name == 'RAM' %}<i class="fa-solid fa-memory fa-2x text-gray-300"></i>{% endif %}
                                                                </div>
                                                            </div>
                                                        </li>
                                                        {% endfor %}
                                                    </ul>

                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        <div class="col-xl-3 col-lg-3">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">Download</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body text-center">

                                                    <ul class="d-flex flex-wrap resource">
                                                        <li class="h5 text-gray-800">
                                                            <div class="row no-gutters align-items-center">
                                                                <div class="col mr-2">
                                                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                                        Manual
                                                                    </div>
                                                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                                        download
                                                                    </div>

                                                                </div>
                                                                <div class="col-auto">
                                                                    <a href="{{references.manual_download}}"><i class="fa-solid fa-download fa-2x"></i></a>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>

                                                </div>
                                            </div>
                                        </div>

                                        <! -- Tasks -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">Tasks</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">

                                                   <div id="task_carousel" class="carousel slide" data-ride="carousel">

                                                       <div class="carousel-inner">
                                                          {% for task_name, task in tasks.items() %}
                                                          <div class="item{% if loop.index == 1 %} active{% endif %}">
                                                                <div class="h4 font-weight-bold text-info text-uppercase mb-1">
                                                                    {{task_name}}
                                                                </div>
                                                                {% set sets = [] %}
                                                                {% set setsvars = [] %}
                                                                {% for file in files %}
                                                                {% set _ = sets.append(file.type) %}
                                                                {% set _ = setsvars.append('X'+file.type) %}
                                                                {% endfor %}
                                                                <div class="container">
                                                                    <div class="row">
                                                                        <div class="col-3">
                                                                           <div class="text-center text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                               {{task.type}}
                                                                           </div>
                                                                           <div>
                                                                               <img style="width:5rem;display:block;margin:auto;" src="/images/{% if task.type == 'classification:multiclass' %}multiclass.svg{% endif %}">
                                                                           </div>
                                                                       </div>
                                                                       <div class="text-center col-3">
                                                                           <div class="text-center text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                              Features
                                                                               <span style="margin-left:0.5rem;" class="position-absolute top-0 translate-middle badge rounded-pill bg-danger">
                                                                                    {{task.features|length}}
                                                                                    <span class="visually-hidden">number of features</span>
                                                                                 </span>
                                                                           </div>
                                                                           {% for feature in task.features %}
                                                                           <div class="chip chip-md success-color white-text  example z-depth-2 mr-0">
                                                                              {{feature}}

                                                                           </div>
                                                                           {% endfor %}
                                                                       </div>
                                                                        {% if task.target_labels %}
                                                                       <div class="text-center col-3">
                                                                           <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                              Target labels
                                                                               <span style="margin-left:0.5rem" class="position-absolute top-0 translate-middle badge rounded-pill bg-danger">
                                                                                    {{task.target_labels|length}}
                                                                                    <span class="visually-hidden">number of features</span>
                                                                                 </span>
                                                                           </div>
                                                                           {% for label in task.target_labels %}
                                                                           <span class="badge bg-secondary" title="{{task.target_descriptions[label]}}">
                                                                              {{label}}
                                                                           </span>
                                                                           {% endfor %}
                                                                       </div>
                                                                       <div class="text-center col-3">
                                                                           <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                              Target distribution
                                                                           </div>
                                                                           <div class="target-dist-chart">
                                                                                <canvas id="target_dist_{{loop.index}}"></canvas>
                                                                           </div>

                                                                       </div>

                                                                        {% endif %}
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-xl-12 col-lg-12">
                                                                            <pre>
                                                                                <code class="python">
  import phm_datasets as phmd

  {{setsvars|join("','")}} = phmd.load('{{name}}', task='{{task.target}}', datasets=['{{sets|join("','")}}']){% if sets|length == 1 %}[0]{% endif %}

                                                                                </code>
                                                                            </pre>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                          </div>
                                                          {% endfor %}
                                                       </div>

                                                    </div>

                                                </div>


                                            </div>

                                        </div>


                                        <! -- Charts -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">Feature charts</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">
                                                    <div id="feature_charts_carousel" class="carousel slide" data-bs-ride="carousel">
                                                        <div class="carousel-inner">
                                                              {% for image in feature_images %}
                                                              <div class="carousel-item{% if loop.index == 1 %} active{% endif %}">
                                                                 <img class="d-block w-100" src="../../images/{{image}}" >
                                                              </div>
                                                              {% endfor %}
                                                        </div>
                                                        <a class="carousel-control-prev" data-bs-target="#feature_charts_carousel" role="button" data-bs-slide="prev">
                                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Previous</span>
                                                        </a>
                                                        <a class="carousel-control-next" data-bs-target="#feature_charts_carousel" role="button" data-bs-slide="next">
                                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Next</span>
                                                        </a>

                                                    </div>

                                                </div>

                                            </div>

                                        </div>

                                        <! -- Results -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">Results</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">
                                                    <div id="results_carousel" class="carousel slide" data-bs-ride="carousel">
                                                        <div class="carousel-inner">
                                                              {% for name, task in tasks.items() %}
                                                              {% include 'dataset_result.html' %}
                                                              {% endfor %}
                                                        </div>
                                                        <a class="carousel-control-prev" data-bs-target="#results_carousel" role="button" data-bs-slide="prev">
                                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Previous</span>
                                                        </a>
                                                        <a class="carousel-control-next" data-bs-target="#results_carousel" role="button" data-bs-slide="next">
                                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Next</span>
                                                        </a>

                                                    </div>

                                                </div>

                                            </div>

                                        </div>

                                        <! -- References -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">References</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">
                                                   <ul>
                                                   {% for ref in references.papers %}
                                                       <li>{{ref.paper}}</li>
                                                   {% endfor %}
                                                   </ul>
                                                </div>

                                            </div>

                                        </div>

                                        <! -- Citation -->
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card shadow mb-4">
                                                <!-- Card Header - Dropdown -->
                                                <div
                                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                    <h6 class="m-0 font-weight-bold text-primary">Citation</h6>

                                                </div>
                                                <!-- Card Body -->
                                                <div class="card-body">
                                                   <p>If you use this dataset in your research, please cite the following paper:</p>
                                                   <ul>
                                                       <li>{{references.citation}}</li>
                                                   </ul>
                                                    <p>If you use have found the <em>phm_datasets</em> package or this page useful, please cite our paper:</p>
                                                   <ul>
                                                       <li>Solis-Martin, David, Juan Galán-Páez, and Joaquin Borrego-Diaz. "......"</li>
                                                   </ul>
                                                </div>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>



                </div>
            </div>
        </div>
  </div>
</div>

<div w3-include-html="../footer.html"></div>

<script src="/files/jquery.min.js"></script>
<script src="/files/bootstrap.min.js"></script>
<script src="/files/bootstrap.bundle.min.js"></script>
<script src="/files/Chart.min.js"></script>

<script>
render();

var label_colors = [];

class ResultTable {
    constructor() {
        this.metrics = ['Paper', 'Technique', 'Mode'];
        this.papers = [];
        this.techniques = [];
        this.descriptions = [];
        this.modes = [];
        this.values = {};
        this.row_map = {};
    }

    add_entry(paper, technique, mode, description) {
        this.papers.push(paper);
        this.techniques.push(technique);
        this.modes.push(mode);
        this.descriptions.push(description);

        this.row_map[paper + '_' + technique + '_' + mode] = this.papers.length;
    }

    add_result(paper, technique, metric, mode, value) {
        if (this.metrics.indexOf(metric) == -1)
            this.metrics.push(metric);
        let key = paper + '_' + technique + '_' + mode;
        let j = this.metrics.indexOf(metric);
        let i = this.row_map[key];

        this.values[String([i,j])] = value;
    }

    generate_table(id) {
        let container = $('#' + id);
        let table = '<table class="table">';
        let info = '<span style="margin-left:0.5rem;font-size:0.6rem;" class="position-relative translate-middle badge rounded-pill bg-secondary" title="#info#">i</span>';

        // header
        table += '<thead></tr>';
        this.metrics.forEach((element) => table += '<th scope="col">' + element + '</th>');
        table += '</tr></thead>';

        // body
        table += '<tbody>';
        for (let i = 0; i < Object.keys(this.row_map).length; i++) {
            table += '<tr>';
            table += '<td>' + this.papers[i] + '</td>';
            table += '<td>' + this.techniques[i] + info.replace('#info#', this.descriptions[i] ) + '</td>';
            table += '<td>' + this.modes[i] + '</td>';

            for(let j = 3; j < this.metrics.length; j++) {
                table += '<td>';
                if (String([i+1,j]) in this.values) {
                    table += this.values[String([i+1,j])];
                }
                table += '</td>';
            }
            table += '</tr>';
        }
        table += '</tbody>';

        // end table
        table += '</table>';
        container.append(table);
    }
}

{% for name, task in tasks.items() %}
var {{task.target}}_results = new ResultTable();
{% for paper, result in results[task.target].items() %}
{% for paper_result in result %}
{{task.target}}_results.add_entry('{{paper}}', '{{paper_result.technique}}', '{{paper_result.mode}}', '{{paper_result.description}}');
{% for metric, metric_results in paper_result.results.items() %}
{% for metric_result in metric_results %}
{{task.target}}_results.add_result('{{paper}}', '{{paper_result['technique']}}', '{{metric|capitalize}}', '{{paper_result.mode}}', {{metric_result.value}});
{% endfor %}
{% endfor %}
{% endfor %}
{% endfor %}
{{task.target}}_results.generate_table('{{task.target}}_results');
{% endfor %}

class HSLColor {
    constructor(colorString) {
        this.colorString = colorString;
        this.hue = 0;
        this.saturation = 0;
        this.lightness = 0;
        this.calculateHSL();
    }

    calculateHSL() {
        let r, g, b;
        if (this.colorString.startsWith("#") && this.colorString.length === 7) {
            r = parseInt(this.colorString.substr(1, 2), 16) / 255;
            g = parseInt(this.colorString.substr(3, 2), 16) / 255;
            b = parseInt(this.colorString.substr(5, 2), 16) / 255;
        } else {
            return null;
        }

        let max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max === min) {
            h = s = 0; // achromatic
        } else {
            let d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        this.hue = h * 360;
        this.saturation = s * 100;
        this.lightness = l * 100;
    }

    toHexRGB() {
        let r, g, b;
        let h = this.hue / 360;
        let s = this.saturation / 100;
        let l = this.lightness / 100;

        if (s === 0) {
            r = g = b = l; // achromatic
        } else {
            let hue2rgb = function hue2rgb(p, q, t) {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };

            let q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            let p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }

        let toHex = function toHex(c) {
            let hex = Math.round(c * 255).toString(16);
            return hex.length === 1 ? "0" + hex : hex;
        };

        return "#" + toHex(r) + toHex(g) + toHex(b);
    }
}

function getLabelsColors(n) {

    let baseColor = "#8A56E2";
    let baseHue = new HSLColor(baseColor).hue;

    let colors = [];
    colors.push(new HSLColor(baseColor));

    let step = 240.0 / n;

    for (let i = 1; i < n; ++i) {
        let nextColor = new HSLColor(baseColor);
        nextColor.hue = (baseHue + step * i) % 240.0;
        colors.push(nextColor);
    }

    return colors.map(e => e.toHexRGB());
}


// Set new default font family and font color to mimic Bootstrap's default styling
Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
Chart.defaults.global.defaultFontColor = '#858796';

function fill_target_dist(labels, values, canvas) {

    // Pie Chart Example
    var ctx = document.getElementById(canvas);
    var myPieChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: values,
          backgroundColor: label_colors,
          hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
          hoverBorderColor: "rgba(234, 236, 244, 1)",
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        tooltips: {
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 0,
          yPadding: 0,
          displayColors: false,
          caretPadding: 10,
        },
        legend: {
          display: false
        },
        cutoutPercentage: 50,
      },
    });

}


{% for name, task in tasks.items() %}
{% if  loop.index == 1 %}
label_colors  = getLabelsColors({{task.target_labels | length}});
{% endif %}
fill_target_dist({{task.target_labels}}, {{task.target_distribution}}, "target_dist_{{loop.index}}");
{% if task.target_labels %}

{% endif %}
{% endfor %}


</script>


</body></html>



